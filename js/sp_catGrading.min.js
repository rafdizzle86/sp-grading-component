(function($){sp_admin.sp_catGrading={setTypeID:function(){if(sp_admin){var types=sp_admin.SP_TYPES;if(types["Grading"]){this.typeID=types["Grading"];sp_admin.SP_TYPES["Grading"]=this}}else{return 0}},addNewFieldHandler:function(buttonElem){var self=this;buttonElem.click(function(){var compid=$(this).data("compid");var fieldNameElem=$("#"+self.FIELD_INPUT_PREFIX+compid);var fieldTypeElem=$("#"+self.GRADING_TYPE_PREFIX+compid);$("#"+self.SUBMIT_LOADER_GIF_PREFIX_ID+compid).show();self.saveNewField(fieldNameElem,fieldTypeElem,compid)})},saveNewField:function(fieldNameElem,fieldTypeElem,compID){var self=this;var gradingFieldInput=$("#"+self.FIELD_INPUT_PREFIX+compID);console.log("#"+self.FIELD_INPUT_PREFIX+compID);console.log(gradingFieldInput);gradingFieldInput.attr("disabled","disabled");$.ajax({url:SP_AJAX_URL,type:"POST",data:{action:"sp_grading_save_field",nonce:SP_NONCE,compid:compID,fieldname:fieldNameElem.val(),fieldtype:fieldTypeElem.val()},dataType:"html",success:function(response){$("#"+self.GRADING_FIELD_CONTAINER+compID).append(response);var editableFieldElemID=$(response).find(".grading-field-editable:first").attr("id");var deleteElemID=$(response).find("."+self.DELETE_FIELD_CLASS).attr("id");self.initEditableFieldName($("#"+editableFieldElemID));self.initDeleteHandler($("#"+deleteElemID));$("#"+self.SUBMIT_LOADER_GIF_PREFIX_ID+compID).hide();gradingFieldInput.val("");gradingFieldInput.removeAttr("disabled")},error:function(jqXHR,statusText,errorThrown){if(smartpost.sp_postComponent)smartpost.sp_postComponent.showError("Status: "+statusText+", Error Thrown:"+errorThrown)}})},saveFieldName:function(newName,fieldKey,compID){$.ajax({url:SP_AJAX_URL,type:"POST",data:{nonce:SP_NONCE,action:"sp_grading_set_field_name",fieldName:newName,fieldKey:fieldKey,compid:compID},dataType:"json",success:function(response,statusText,jqXHR){},error:function(jqXHR,statusText,errorThrown){sp_admin.adminpage.showError(errorThrown,null)}})},initEditableFieldName:function(fieldElems){var self=this;fieldElems.editable(function(value,settings){var fieldKey=$(this).data("fieldkey");var compID=$(this).data("compid");self.saveFieldName(value,fieldKey,compID);return value},{placeholder:"Click to add a grading field name",onblur:"submit",cssclass:"editableCatCompTitle",maxlength:35})},deleteField:function(fieldKey,compID){var self=this;$.ajax({url:SP_AJAX_URL,type:"POST",data:{nonce:SP_NONCE,action:"sp_grading_delete_field",fieldKey:fieldKey,compid:compID},dataType:"json",success:function(response,statusText,jqXHR){$("#"+self.GRADING_FIELD_ROW_PREFIX_ID+compID+"-"+fieldKey).remove()},error:function(jqXHR,statusText,errorThrown){sp_admin.adminpage.showError(errorThrown,null)}})},initDeleteHandler:function(deleteElem){var self=this;deleteElem.click(function(){var fieldKey=$(this).data("fieldkey");var compid=$(this).data("compid");$("#"+self.GRADING_FIELD_ROW_PREFIX_ID+compid+"-"+fieldKey).html('<td><img src="'+SP_IMAGE_PATH+'/loading.gif"> Removing field...</td>');self.deleteField(fieldKey,compid)})},initComponent:function(componentElem){var self=this;var addNewFieldButton=componentElem.find("."+self.ADD_NEW_FIELD_BUTTON_CLASS);self.addNewFieldHandler(addNewFieldButton);if(smartpost.sp_post){var spEditor=componentElem.find(".sp-editor-content");smartpost.sp_post.initCkEditors(spEditor)}},init:function(){var self=this;self.DELETE_FIELD_CLASS="sp-grading-delete";self.FIELD_INPUT_PREFIX="sp-new-grading-field-";self.GRADING_TYPE_PREFIX="grading-type-";self.GRADING_FIELD_CONTAINER="sp-grading-field-container-";self.ADD_NEW_FIELD_BUTTON_CLASS="submit-new-grading-field";self.GRADING_FIELD_EDITABLE_CLASS="grading-field-editable";self.GRADING_FIELD_ROW_PREFIX_ID="sp-field-row-";self.SUBMIT_LOADER_GIF_PREFIX_ID="sp-grading-submit-loader-";self.addNewFieldHandler($("."+self.ADD_NEW_FIELD_BUTTON_CLASS));self.initEditableFieldName($("."+self.GRADING_FIELD_EDITABLE_CLASS));self.initDeleteHandler($("."+self.DELETE_FIELD_CLASS));self.setTypeID()}};$(document).ready(function(){sp_admin.sp_catGrading.init()})})(jQuery);